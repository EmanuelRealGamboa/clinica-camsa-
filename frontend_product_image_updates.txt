# CAMBIOS DETALLADOS PARA EL FRONTEND

## Archivo 1: src/pages/admin/ProductsManagementPage.tsx

### Cambio 1: Agregar estados (después de la línea 24)
```typescript
  const [selectedImageFile, setSelectedImageFile] = useState<File | null>(null);
  const [imagePreview, setImagePreview] = useState<string | null>(null);
```

### Cambio 2: Reemplazar handleProductSubmit completo (líneas 81-121)
```typescript
  const handleProductSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    try {
      const formData = new FormData();
      formData.append('name', productForm.name);
      formData.append('description', productForm.description);
      formData.append('category', productForm.category);
      formData.append('sku', productForm.sku);
      formData.append('unit_label', productForm.unit_label);
      formData.append('is_active', productForm.is_active.toString());

      if (!selectedImageFile && productForm.image_url) {
        formData.append('image_url', productForm.image_url);
      }

      if (selectedImageFile) {
        formData.append('image', selectedImageFile);
      }

      if (editingProduct) {
        await adminApi.updateProduct(editingProduct.id, formData);
        setSuccessModal({
          show: true,
          title: 'Product Updated',
          message: `Product "${productForm.name}" has been updated successfully.`,
        });
      } else {
        await adminApi.createProduct(formData);
        setSuccessModal({
          show: true,
          title: 'Product Created',
          message: `Product "${productForm.name}" has been created successfully.`,
        });
      }

      setShowModal(false);
      setEditingProduct(null);
      setSelectedImageFile(null);
      setImagePreview(null);
      resetProductForm();
      loadData();
    } catch (err: any) {
      console.error('Failed to save product:', err);
      setConfirmModal({
        show: true,
        title: 'Error',
        message: err.response?.data?.error || 'Failed to save product',
        onConfirm: () => setConfirmModal({ ...confirmModal, show: false }),
        confirmText: 'OK',
        cancelText: undefined,
      });
    }
  };
```

### Cambio 3: Actualizar handleEditProduct (líneas 158-170)
```typescript
  const handleEditProduct = (product: any) => {
    setEditingProduct(product);
    setProductForm({
      name: product.name,
      description: product.description || '',
      image_url: product.image_url || '',
      category: product.category.toString(),
      sku: product.sku || '',
      unit_label: product.unit_label || 'unidad',
      is_active: product.is_active,
    });
    if (product.image_url_full) {
      setImagePreview(product.image_url_full);
    } else {
      setImagePreview(null);
    }
    setSelectedImageFile(null);
    setShowModal(true);
  };
```

### Cambio 4: Actualizar resetProductForm (líneas 172-182)
```typescript
  const resetProductForm = () => {
    setProductForm({
      name: '',
      description: '',
      image_url: '',
      category: '',
      sku: '',
      unit_label: 'unidad',
      is_active: true,
    });
    setSelectedImageFile(null);
    setImagePreview(null);
  };
```

### Cambio 5: Agregar funciones de manejo de imagen (antes de handleCategorySubmit, línea 184)
```typescript
  const handleImageChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (file) {
      setSelectedImageFile(file);
      const reader = new FileReader();
      reader.onloadend = () => {
        setImagePreview(reader.result as string);
      };
      reader.readAsDataURL(file);
    }
  };

  const handleRemoveImage = () => {
    setSelectedImageFile(null);
    setImagePreview(null);
    if (productForm.image_url) {
      setProductForm({...productForm, image_url: ''});
    }
  };

  // Category handlers
```

### Cambio 6: Actualizar el modal del formulario de producto
Reemplazar el section del form (líneas 452-535) con:
```tsx
            <form onSubmit={handleProductSubmit} style={styles.form}>
              <div style={styles.formGroup}>
                <label style={styles.label}>Name *</label>
                <input
                  type="text"
                  value={productForm.name}
                  onChange={(e) => setProductForm({...productForm, name: e.target.value})}
                  style={styles.input}
                  required
                />
              </div>
              <div style={styles.formGroup}>
                <label style={styles.label}>Description</label>
                <textarea
                  value={productForm.description}
                  onChange={(e) => setProductForm({...productForm, description: e.target.value})}
                  style={{...styles.input, minHeight: '80px'}}
                />
              </div>

              <div style={styles.formGroup}>
                <label style={styles.label}>Product Image</label>
                {imagePreview && (
                  <div style={styles.imagePreviewContainer}>
                    <img src={imagePreview} alt="Preview" style={styles.imagePreview} />
                    <button
                      type="button"
                      onClick={handleRemoveImage}
                      style={styles.removeImageButton}
                    >
                      Remove Image
                    </button>
                  </div>
                )}
                <input
                  type="file"
                  accept="image/*"
                  onChange={handleImageChange}
                  style={styles.input}
                />
                <small style={styles.helpText}>
                  Upload an image file (recommended) or use Image URL below
                </small>
              </div>

              <div style={styles.formGroup}>
                <label style={styles.label}>Image URL (Optional)</label>
                <input
                  type="url"
                  value={productForm.image_url}
                  onChange={(e) => setProductForm({...productForm, image_url: e.target.value})}
                  style={styles.input}
                  placeholder="https://..."
                  disabled={!!selectedImageFile}
                />
                <small style={styles.helpText}>
                  External image URL (only if not uploading a file)
                </small>
              </div>

              <div style={styles.formRow}>
                <div style={styles.formGroup}>
                  <label style={styles.label}>SKU</label>
                  <input
                    type="text"
                    value={productForm.sku}
                    onChange={(e) => setProductForm({...productForm, sku: e.target.value})}
                    style={styles.input}
                  />
                </div>
                <div style={styles.formGroup}>
                  <label style={styles.label}>Unit Label</label>
                  <input
                    type="text"
                    value={productForm.unit_label}
                    onChange={(e) => setProductForm({...productForm, unit_label: e.target.value})}
                    style={styles.input}
                    placeholder="unidad, pieza, botella..."
                  />
                </div>
              </div>
              <div style={styles.formGroup}>
                <label style={styles.label}>Category *</label>
                <select
                  value={productForm.category}
                  onChange={(e) => setProductForm({...productForm, category: e.target.value})}
                  style={styles.input}
                  required
                >
                  <option value="">Select a category</option>
                  {categories.filter(c => c.is_active).map(cat => (
                    <option key={cat.id} value={cat.id}>{cat.name}</option>
                  ))}
                </select>
              </div>
              <div style={styles.formGroup}>
                <label style={styles.label}>
                  <input
                    type="checkbox"
                    checked={productForm.is_active}
                    onChange={(e) => setProductForm({...productForm, is_active: e.target.checked})}
                    style={{marginRight: '8px'}}
                  />
                  Active
                </label>
              </div>
              <div style={styles.formActions}>
                <button type="button" onClick={() => {
                  setShowModal(false);
                  setSelectedImageFile(null);
                  setImagePreview(null);
                }} style={styles.cancelButton}>
                  Cancel
                </button>
                <button type="submit" style={styles.submitButton}>
                  {editingProduct ? 'Update' : 'Create'}
                </button>
              </div>
            </form>
```

### Cambio 7: Agregar estilos (en el objeto styles, después de successButton)
```typescript
  imagePreviewContainer: {
    marginBottom: '15px',
    textAlign: 'center' as const,
  },
  imagePreview: {
    maxWidth: '100%',
    maxHeight: '200px',
    borderRadius: '8px',
    marginBottom: '10px',
    objectFit: 'cover' as const,
  },
  removeImageButton: {
    padding: '8px 16px',
    backgroundColor: '#e74c3c',
    color: 'white',
    border: 'none',
    borderRadius: '4px',
    cursor: 'pointer',
    fontSize: '14px',
  },
  helpText: {
    fontSize: '12px',
    color: '#666',
    fontStyle: 'italic' as const,
    display: 'block' as const,
    marginTop: '5px',
  },
```

## Archivo 2: src/pages/kiosk/KioskPage.tsx

### Cambio 1: Actualizar productCard (línea 491 - dentro del map de filteredProducts)
```tsx
              <div key={product.id} style={styles.productCard}>
                {product.image_url_full && (
                  <img
                    src={product.image_url_full}
                    alt={product.name}
                    style={styles.productImage}
                    onError={(e) => {
                      e.currentTarget.style.display = 'none';
                    }}
                  />
                )}
                <div style={styles.productContent}>
                  <h3>{product.name}</h3>
                  <p style={styles.description}>{product.description}</p>
                  <p style={styles.unit}>{product.unit_label}</p>
                </div>
                <div style={styles.productActions}>
                  {qty > 0 ? (
                    <div style={styles.quantityControl}>
                      <button onClick={() => removeFromCart(product.id)} style={styles.qtyButton}>
                        -
                      </button>
                      <span style={styles.quantity}>{qty}</span>
                      <button onClick={() => addToCart(product.id)} style={styles.qtyButton}>
                        +
                      </button>
                    </div>
                  ) : (
                    <button onClick={() => addToCart(product.id)} style={styles.addButton}>
                      Add to Order
                    </button>
                  )}
                </div>
              </div>
```

### Cambio 2: Agregar estilos en KioskPage (en el objeto styles)
```typescript
  productImage: {
    width: '100%',
    height: '150px',
    objectFit: 'cover' as const,
    borderRadius: '8px 8px 0 0',
  },
  productContent: {
    padding: '0 20px',
  },
```

### Cambio 3: Actualizar productCard style (línea 816)
```typescript
  productCard: {
    backgroundColor: 'white',
    borderRadius: '8px',
    boxShadow: '0 2px 4px rgba(0,0,0,0.1)',
    overflow: 'hidden' as const,
    display: 'flex' as const,
    flexDirection: 'column' as const,
  },
```
